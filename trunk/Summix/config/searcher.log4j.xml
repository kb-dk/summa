<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE log4j:configuration SYSTEM "log4j.dtd">

<log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/" debug="false">

    <appender name="FILE" class="dk.statsbiblioteket.summa.common.util.CleanSlateRollingFileAppender">
        <param name="Threshold" value="DEBUG"/>
        <param name="File" value="log/searcher.log"/>
        <param name="Append" value="true"/>
        <param name="MaxFileSize" value="500MB"/>
        <param name="MaxBackupIndex" value="5"/>
        <layout class="org.apache.log4j.PatternLayout">
            <param name="ConversionPattern" value="%-5p [%t] [%d] [%c] %m%n"/>
        </layout>
    </appender>

    <appender name="QUERIES" class="dk.statsbiblioteket.summa.common.util.CleanSlateRollingFileAppender">
        <param name="Threshold" value="DEBUG"/>
        <param name="File" value="log/queries.log"/>
        <param name="Append" value="true"/>
        <param name="MaxFileSize" value="500MB"/>
        <param name="MaxBackupIndex" value="5"/>
        <layout class="org.apache.log4j.PatternLayout">
            <param name="ConversionPattern" value="%-5p [%t] [%d] [%c] %m%n"/>
        </layout>
    </appender>

    <!-- The full log appender uses a extremely slow pattern, on production systems use only this appender with a threshold of fatal -->
    <appender name="FATAL_LOG" class="dk.statsbiblioteket.summa.common.util.CleanSlateRollingFileAppender">
        <param name="Threshold" value="ERROR"/>
        <param name="File" value="log/searcher.fatal.log"/>
        <param name="Append" value="true"/>
        <param name="MaxFileSize" value="1MB"/>
        <param name="MaxBackupIndex" value="5"/>
        <layout class="org.apache.log4j.PatternLayout">
            <param name="ConversionPattern" value="%-5p [%t] [%d] [%c] - %l [LINENUMBER: %L] [METHOD: %M] [%X]  %m%n"/>
        </layout>
    </appender>

    <!-- This logger stores all encountered queries on DEBUG level.
         We would very much like to run this on DEBUG in production
         as it helps tremendously with load measurement. -->
    <logger name="queries">
        <level value="debug" />
        <appender-ref ref="QUERIES" />
    </logger>

    <!-- The fatal-logger is special as it is guaranteed from the code that only fatalities are logged here.
         However, due to slf4j, the highest level is ERROR and thus we need to set that as our level -->
    <logger name="fatal">
        <level value="ERROR" />
        <appender-ref ref="FATAL_LOG" />
    </logger>

    <!-- all loggers inherit the root logger - so don't include the root appenders in the other loggers
    (will duplicate log entries in the log file) -->
    <root>
        <level value="DEBUG" />
        <appender-ref ref="FILE" />
    </root>

</log4j:configuration>
